#!/usr/bin/env bash
do_pop=0
for d in . .. ../build ../build-debug ../build-release; do
  if [ -f "$d/Makefile" ]; then
    BUILD_DIR="$d"
    if [ "$BUILD_DIR" != "." ]; then
      pushd "$BUILD_DIR"
      do_pop=1
    fi
    make "$@"
    break
  fi
done
if [ ! "$BUILD_DIR" ]; then
  make --help
  return 1
fi

result=$?
[ $result -eq 0 ] && echo -e "\e[92mOK\e[0m" || echo -e "\e[91mFAILED\e[0m"
if [ $do_pop -eq 1 ]; then
  popd
fi

exit $result
